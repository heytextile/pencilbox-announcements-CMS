<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banner Preview - Pencilbox Announcements</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            min-height: 100vh;
        }
        
        .preview-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .header h1 {
            color: #333;
            margin: 0 0 10px 0;
        }
        
        .header p {
            color: #666;
            margin: 0;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        label {
            font-weight: 500;
            color: #333;
        }
        
        select, input, button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        button {
            background: #0066cc;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }
        
        button:hover {
            background: #0052a3;
        }
        
        button.secondary {
            background: #6c757d;
        }
        
        button.secondary:hover {
            background: #545b62;
        }
        
        .preview-area {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(120, 150, 220, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 200, 150, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(200, 120, 255, 0.2) 0%, transparent 50%);
            border: 2px solid #e9ecef;
            border-radius: 8px;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }
        
        .demo-page {
            padding: 40px;
            text-align: center;
            color: #666;
            line-height: 1.6;
        }
        
        .banner-info {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 14px;
            color: #495057;
        }
        
        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="preview-container">
        <div class="header">
            <h1>ðŸŽ¯ Banner Preview Tool</h1>
            <p>Test and preview your banners locally before deployment</p>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="bannerSelect">Banner:</label>
                <select id="bannerSelect">
                    <option value="">Select a banner...</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="hostnameInput">Test Hostname:</label>
                <input type="text" id="hostnameInput" placeholder="e.g., hfn.pencilbox.work" value="hfn.pencilbox.work">
            </div>
            
            <button id="previewBtn">Preview Banner</button>
            <button id="clearBtn" class="secondary">Clear Banner</button>
        </div>
        
        <div class="preview-area" id="previewArea">
            <div class="demo-page">
                <h2>Sample Website Content</h2>
                <p>This simulates a real website where your banner would appear.</p>
                <p>Use the controls above to preview different banners.</p>
                <p>The banner will appear at the bottom of this area, just like it would on a real site.</p>
                
                <div style="margin-top: 40px;">
                    <h3>Some Sample Content</h3>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                </div>
            </div>
        </div>
        
        <div id="bannerInfo" class="banner-info" style="display: none;">
            <strong>Banner Info:</strong> <span id="bannerDetails"></span>
        </div>
    </div>

    <!-- Load the actual banner system (minified versions) -->
    <link rel="stylesheet" href="dist/banner.min.css">
    <script src="dist/banner.min.js"></script>
    
    <script>
        let bannerConfig = {};
        
        // Load banner configuration
        async function loadBannerList() {
            try {
                // Add cache-busting parameter
                const response = await fetch('./banners.json?t=' + Date.now());
                bannerConfig = await response.json();
                const select = document.getElementById('bannerSelect');
                
                // Clear existing options except first
                select.innerHTML = '<option value="">Select a banner...</option>';
                
                console.log('Loaded banner config:', bannerConfig);
                
                // Add banners from config
                Object.entries(bannerConfig.clients || {}).forEach(([hostname, bannerPath]) => {
                    const option = document.createElement('option');
                    option.value = bannerPath;
                    option.textContent = `${hostname} â†’ ${bannerPath}`;
                    select.appendChild(option);
                    console.log('Added banner option:', { hostname, bannerPath });
                });
                
                // Auto-select first banner if available
                if (select.options.length > 1) {
                    select.selectedIndex = 1;
                    console.log('Auto-selected:', select.value);
                }
                
            } catch (error) {
                console.error('Error loading banner config:', error);
                showError('Error loading banners.json: ' + error.message);
            }
        }
        
        // Preview functionality
        document.getElementById('previewBtn').addEventListener('click', async () => {
            const bannerFile = document.getElementById('bannerSelect').value;
            const hostname = document.getElementById('hostnameInput').value;
            
            console.log('Preview clicked:', { bannerFile, hostname });
            
            if (!bannerFile) {
                alert('Please select a banner to preview');
                return;
            }
            
            if (!hostname) {
                alert('Please enter a test hostname');
                return;
            }
            
            try {
                // Clear any existing banners first
                clearBanner();
                
                // Construct the full URL for debugging
                const bannerUrl = '.' + bannerFile;
                console.log('Fetching banner from:', bannerUrl);
                
                // Load the banner HTML
                const response = await fetch(bannerUrl);
                console.log('Response status:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`Failed to load banner: ${response.status} ${response.statusText}`);
                }
                const bannerHtml = await response.text();
                console.log('Banner HTML loaded, length:', bannerHtml.length);
                
                // Create and show banner
                createBanner(bannerHtml, bannerFile, hostname);
                
            } catch (error) {
                console.error('Error loading banner:', error);
                showError('Error loading banner: ' + error.message);
            }
        });
        
        function createBanner(bannerHtml, bannerFile, hostname) {
            // Create banner element
            const bannerElement = document.createElement("div");
            bannerElement.className = "pencilbox-banner";
            bannerElement.innerHTML = bannerHtml + '<div class="banner-close">Ã—</div>';
            
            // Add banner to page
            document.body.appendChild(bannerElement);
            
            // Show banner with animation
            setTimeout(() => bannerElement.classList.add("show"), 100);
            
            // Handle close button
            bannerElement.querySelector(".banner-close").onclick = () => {
                bannerElement.classList.remove("show");
                setTimeout(() => bannerElement.remove(), 500);
                clearBannerInfo();
            };
            
            // Update info
            showBannerInfo(`Showing "${bannerFile}" for hostname "${hostname}"`);
        }
        
        document.getElementById('clearBtn').addEventListener('click', clearBanner);
        
        function clearBanner() {
            const existingBanner = document.querySelector('.pencilbox-banner');
            if (existingBanner) {
                existingBanner.classList.remove("show");
                setTimeout(() => existingBanner.remove(), 500);
            }
            clearBannerInfo();
        }
        
        function showBannerInfo(message) {
            document.getElementById('bannerDetails').textContent = message;
            document.getElementById('bannerInfo').style.display = 'block';
        }
        
        function clearBannerInfo() {
            document.getElementById('bannerInfo').style.display = 'none';
        }
        
        function showError(message) {
            const bannerInfo = document.getElementById('bannerInfo');
            bannerInfo.innerHTML = '<div class="error">' + message + '</div>';
            bannerInfo.style.display = 'block';
        }
        
        // Initialize
        loadBannerList();
    </script>
</body>
</html>