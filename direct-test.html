<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct Thanksgiving Banner Test</title>
    <link rel="stylesheet" href="src/banner.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            min-height: 100vh;
        }
        .demo-content {
            max-width: 800px;
            margin: 60px auto 0;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="demo-content">
        <h1>Direct Thanksgiving Banner Test</h1>
        <p>This page loads the Thanksgiving banner directly to test the animation.</p>
        <p>You should see:</p>
        <ol>
            <li>Thanksgiving banner at the top</li>
            <li>After 1.5 seconds, falling leaves animation</li>
            <li>Animation runs for 6 seconds</li>
            <li>Everything fades out</li>
        </ol>
        <button onclick="loadBanner()">Load Banner</button>
        <button onclick="clearDismissal()">Clear Dismissal & Reload</button>
    </div>

    <script>
        function clearDismissal() {
            localStorage.clear();
            location.reload();
        }
        
        function loadBanner() {
            // Clear any existing banners
            const existing = document.querySelector('.pencilbox-banner');
            if (existing) existing.remove();
            
            // Directly load the thanksgiving banner content
            fetch('banners/thanksgiving-2025.html')
                .then(response => response.text())
                .then(bannerHtml => {
                    console.log('Banner HTML loaded');
                    
                    const bannerElement = document.createElement("div");
                    bannerElement.className = "pencilbox-banner";

                    // Parse HTML to extract scripts safely
                    const temp = document.createElement("div");
                    temp.innerHTML = bannerHtml;

                    // Remove all <script> tags from the HTML string
                    const cleanHtml = bannerHtml.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, "");
                    const scripts = Array.from(temp.querySelectorAll("script"));

                    // Insert clean HTML + close button
                    bannerElement.innerHTML = cleanHtml + '<div class="banner-close">Ã—</div>';
                    document.body.appendChild(bannerElement);

                    // Show banner
                    setTimeout(() => bannerElement.classList.add("show"), 100);

                    // Re-inject and execute any scripts that were in the banner
                    scripts.forEach(oldScript => {
                        const newScript = document.createElement("script");
                        if (oldScript.src) {
                            newScript.src = oldScript.src;
                            newScript.async = false;
                        } else {
                            newScript.textContent = oldScript.textContent;
                        }
                        bannerElement.appendChild(newScript);
                    });

                    // Close button handler
                    bannerElement.querySelector(".banner-close").onclick = () => {
                        bannerElement.classList.remove("show");
                        setTimeout(() => bannerElement.remove(), 500);
                    };
                })
                .catch(err => {
                    console.error("Banner load error:", err);
                    alert('Error loading banner: ' + err.message);
                });
        }
        
        // Auto-load on page load
        setTimeout(loadBanner, 1000);
    </script>
</body>
</html>